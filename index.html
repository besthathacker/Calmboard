<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CalmBoard - 50+ Calming Sounds</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #121212;
      color: #eee;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      user-select: none;
    }
    h1 {
      font-weight: 700;
      font-size: 2.5rem;
      margin-bottom: 15px;
      text-align: center;
    }
    #soundControls {
      display: grid;
      grid-template-columns: repeat(auto-fill,minmax(180px,1fr));
      gap: 15px;
      max-width: 1000px;
      width: 100%;
      margin-bottom: 30px;
    }
    .sound-control {
      background: #1e1e1e;
      border-radius: 10px;
      padding: 12px 15px;
      display: flex;
      flex-direction: column;
      align-items: center;
      box-shadow: 0 3px 8px rgba(0,0,0,0.5);
    }
    .sound-name {
      margin-bottom: 10px;
      font-weight: 600;
      font-size: 1rem;
      text-align: center;
      min-height: 40px;
    }
    button.play-btn {
      background-color: #4caf50;
      border: none;
      border-radius: 50%;
      width: 48px;
      height: 48px;
      font-size: 1.5rem;
      color: white;
      cursor: pointer;
      margin-bottom: 12px;
      transition: background-color 0.3s ease;
      user-select: none;
    }
    button.play-btn.paused {
      background-color: #f44336;
    }
    button.play-btn:focus {
      outline: none;
      box-shadow: 0 0 5px #4caf50;
    }
    input[type="range"] {
      width: 100%;
      -webkit-appearance: none;
      height: 8px;
      border-radius: 5px;
      background: #555;
      cursor: pointer;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #4caf50;
      cursor: pointer;
      border: none;
      margin-top: -5px;
      transition: background-color 0.3s ease;
    }
    input[type="range"]:focus::-webkit-slider-thumb {
      background: #81c784;
    }
    #controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 15px;
      margin-bottom: 40px;
      max-width: 1000px;
      width: 100%;
    }
    #controls button {
      background-color: #2196f3;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      color: white;
      font-size: 1rem;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.3s ease;
      flex: 1 1 120px;
      min-width: 120px;
    }
    #controls button:hover {
      background-color: #1769aa;
    }
    #recordStatus {
      text-align: center;
      font-weight: 600;
      font-size: 1.1rem;
      margin-top: 10px;
      min-height: 22px;
    }
    footer {
      margin-top: auto;
      padding: 12px 0;
      color: #777;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <h1>CalmBoard</h1>

  <div id="soundControls"></div>

  <div id="controls">
    <button id="startAllBtn">Start All ‚ñ∂Ô∏è</button>
    <button id="muteAllBtn">Mute All üîá</button>
    <button id="stopAllBtn">Stop All ‚èπÔ∏è</button>
    <button id="saveStateBtn">Save State üíæ</button>
    <button id="loadStateBtn">Load State üìÇ</button>
    <button id="startRecBtn">Start Recording üéôÔ∏è</button>
    <button id="stopRecBtn" disabled>Stop Recording ‚èπÔ∏è</button>
  </div>
  <div id="recordStatus"></div>

  <footer>Made With ‚ù§Ô∏è By Aiden</footer>

  <script src="https://cdn.jsdelivr.net/npm/lamejs@1.2.0/lame.min.js"></script>
  <script>
    (async () => {
      const soundData = [
        {name: "Rain", url: "https://cdn.pixabay.com/download/audio/2021/08/04/audio_0a6a6e75ab.mp3?filename=rain-ambient-5514.mp3"},
        {name: "Ocean Waves", url: "https://cdn.pixabay.com/download/audio/2021/11/24/audio_0e7dcd82f1.mp3?filename=ocean-waves-10025.mp3"},
        {name: "Forest Night", url: "https://cdn.pixabay.com/download/audio/2022/03/23/audio_446e3e461e.mp3?filename=forest-night-12865.mp3"},
        {name: "Fireplace", url: "https://cdn.pixabay.com/download/audio/2022/02/07/audio_6f9a193ea9.mp3?filename=fireplace-12012.mp3"},
        {name: "Birds Chirping", url: "https://cdn.pixabay.com/download/audio/2021/09/02/audio_3f363d4915.mp3?filename=birds-7749.mp3"},
        {name: "Water Stream", url: "https://cdn.pixabay.com/download/audio/2021/09/07/audio_efb783b7e5.mp3?filename=stream-7950.mp3"},
        {name: "Wind Chimes", url: "https://cdn.pixabay.com/download/audio/2021/11/02/audio_0e44de06a3.mp3?filename=wind-chimes-9343.mp3"},
        {name: "Night Crickets", url: "https://cdn.pixabay.com/download/audio/2021/08/18/audio_5d4a0d56b0.mp3?filename=crickets-6697.mp3"},
        {name: "Thunderstorm", url: "https://cdn.pixabay.com/download/audio/2021/07/15/audio_c3f32c5b31.mp3?filename=thunderstorm-6291.mp3"},
        {name: "Gentle Breeze", url: "https://cdn.pixabay.com/download/audio/2021/10/16/audio_80d0f582c0.mp3?filename=gentle-wind-8624.mp3"},
        {name: "Meditation Bells", url: "https://cdn.pixabay.com/download/audio/2022/05/14/audio_3a33a5b715.mp3?filename=meditation-bells-13862.mp3"},
        {name: "Calm Ocean", url: "https://cdn.pixabay.com/download/audio/2022/03/10/audio_18c35bf5d8.mp3?filename=calm-ocean-12752.mp3"},
        {name: "Soft Piano", url: "https://cdn.pixabay.com/download/audio/2021/08/05/audio_19a9c2f5f5.mp3?filename=soft-piano-5533.mp3"},
        {name: "Rain on Tent", url: "https://cdn.pixabay.com/download/audio/2021/07/11/audio_118f1c5ec5.mp3?filename=rain-on-tent-6213.mp3"},
        {name: "Water Drops", url: "https://cdn.pixabay.com/download/audio/2022/01/25/audio_0a3e4cc006.mp3?filename=water-drops-11161.mp3"},
        {name: "River Flow", url: "https://cdn.pixabay.com/download/audio/2021/09/17/audio_00bc8d457d.mp3?filename=river-flow-8132.mp3"},
        {name: "Wind in Trees", url: "https://cdn.pixabay.com/download/audio/2022/01/31/audio_2163c81c8f.mp3?filename=wind-in-trees-11232.mp3"},
        {name: "Cave Drips", url: "https://cdn.pixabay.com/download/audio/2021/10/11/audio_9b01f7cc7e.mp3?filename=cave-drips-8495.mp3"},
        {name: "Waterfall", url: "https://cdn.pixabay.com/download/audio/2021/07/28/audio_6f29f9c4e4.mp3?filename=waterfall-6456.mp3"},
        {name: "Underwater", url: "https://cdn.pixabay.com/download/audio/2021/09/19/audio_f3d4dfb9bb.mp3?filename=underwater-8195.mp3"},
        // Add more sounds as in previous code ...
      ];

      const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      let masterGain = audioCtx.createGain();
      masterGain.gain.value = 1;
      masterGain.connect(audioCtx.destination);

      const sounds = [];
      const container = document.getElementById("soundControls");

      soundData.forEach((sound, index) => {
        const soundDiv = document.createElement("div");
        soundDiv.className = "sound-control";

        const nameEl = document.createElement("div");
        nameEl.className = "sound-name";
        nameEl.textContent = sound.name;

        const playBtn = document.createElement("button");
        playBtn.className = "play-btn";
        playBtn.title = `Play/Pause ${sound.name}`;
        playBtn.textContent = "‚ñ∂Ô∏è";

        const volumeSlider = document.createElement("input");
        volumeSlider.type = "range";
        volumeSlider.min = 0;
        volumeSlider.max = 1;
        volumeSlider.step = 0.01;
        volumeSlider.value = 0.5;

        soundDiv.appendChild(nameEl);
        soundDiv.appendChild(playBtn);
        soundDiv.appendChild(volumeSlider);
        container.appendChild(soundDiv);

        sounds.push({
          buffer: null,
          source: null,
          gainNode: audioCtx.createGain(),
          isPlaying: false,
          playBtn,
          volumeSlider,
          name: sound.name,
        });

        sounds[index].gainNode.connect(masterGain);

        fetch(sound.url)
          .then(res => res.arrayBuffer())
          .then(data => audioCtx.decodeAudioData(data))
          .then(buffer => {
            sounds[index].buffer = buffer;
          })
          .catch(e => console.error("Error loading sound:", sound.name, e));

        playBtn.addEventListener("click", async () => {
          if (audioCtx.state === 'suspended') await audioCtx.resume();

          const soundObj = sounds[index];

          if (soundObj.isPlaying) {
            stopSound(index);
          } else {
            playSound(index);
          }
        });

        volumeSlider.addEventListener("input", () => {
          const gainValue = parseFloat(volumeSlider.value);
          sounds[index].gainNode.gain.setTargetAtTime(gainValue, audioCtx.currentTime, 0.01);
        });
      });

      function playSound(idx) {
        const soundObj = sounds[idx];
        if (!soundObj.buffer) return;

        const source = audioCtx.createBufferSource();
        source.buffer = soundObj.buffer;
        source.loop = true;
        source.connect(soundObj.gainNode);
        source.start(0);

        soundObj.source = source;
        soundObj.isPlaying = true;
        soundObj.playBtn.textContent = "‚è∏Ô∏è";
        soundObj.playBtn.classList.add("paused");
      }

      function stopSound(idx) {
        const soundObj = sounds[idx];
        if (soundObj.source) {
          soundObj.source.stop();
          soundObj.source.disconnect();
          soundObj.source = null;
        }
        soundObj.isPlaying = false;
        soundObj.playBtn.textContent = "‚ñ∂Ô∏è";
        soundObj.playBtn.classList.remove("paused");
      }

      // Global controls
      document.getElementById("startAllBtn").addEventListener("click", async () => {
        if (audioCtx.state === 'suspended') await audioCtx.resume();
        sounds.forEach((s, i) => {
          if (!s.isPlaying) playSound(i);
        });
      });

      document.getElementById("muteAllBtn").addEventListener("click", () => {
        masterGain.gain.setTargetAtTime(0, audioCtx.currentTime, 0.01);
      });

      document.getElementById("stopAllBtn").addEventListener("click", () => {
        sounds.forEach((_, idx) => stopSound(idx));
      });

      // Save and Load State
      document.getElementById("saveStateBtn").addEventListener("click", () => {
        const state = sounds.map(s => ({
          name: s.name,
          volume: s.volumeSlider.value,
          isPlaying: s.isPlaying
        }));
        localStorage.setItem("calmboardState", JSON.stringify(state));
        alert("State saved!");
      });

      document.getElementById("loadStateBtn").addEventListener("click", () => {
        const state = JSON.parse(localStorage.getItem("calmboardState"));
        if (!state) {
          alert("No saved state found.");
          return;
        }
        state.forEach((s, i) => {
          sounds[i].volumeSlider.value = s.volume;
          sounds[i].gainNode.gain.setTargetAtTime(parseFloat(s.volume), audioCtx.currentTime, 0.01);
          if (s.isPlaying) {
            playSound(i);
          } else {
            stopSound(i);
          }
        });
        alert("State loaded!");
      });

      // Recording setup
      let mediaRecorder;
      let recordedChunks = [];
      const recordStatus = document.getElementById("recordStatus");
      const startRecBtn = document.getElementById("startRecBtn");
      const stopRecBtn = document.getElementById("stopRecBtn");

      async function mixAndRecord() {
        if (audioCtx.state === 'suspended') await audioCtx.resume();

        const dest = audioCtx.createMediaStreamDestination();

        sounds.forEach(s => {
          if (s.isPlaying) {
            s.gainNode.connect(dest);
          }
        });

        mediaRecorder = new MediaRecorder(dest.stream);

        mediaRecorder.ondataavailable = e => {
          if (e.data.size > 0) {
            recordedChunks.push(e.data);
          }
        };

        mediaRecorder.onstop = () => {
          const blob = new Blob(recordedChunks, { type: "audio/webm" });
          recordedChunks = [];
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.style.display = "none";
          a.href = url;
          a.download = "calmboard_recording.webm";
          document.body.appendChild(a);
          a.click();
          URL.revokeObjectURL(url);
          a.remove();
          recordStatus.textContent = "Recording saved!";
          sounds.forEach(s => {
            try { s.gainNode.disconnect(dest); } catch {}
          });
        };

        mediaRecorder.start();
        recordStatus.textContent = "Recording...";
      }

      startRecBtn.addEventListener("click", () => {
        mixAndRecord();
        startRecBtn.disabled = true;
        stopRecBtn.disabled = false;
      });

      stopRecBtn.addEventListener("click", () => {
        if (mediaRecorder && mediaRecorder.state !== "inactive") {
          mediaRecorder.stop();
          startRecBtn.disabled = false;
          stopRecBtn.disabled = true;
        }
      });
    })();
  </script>
</body>
</html>
