<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CalmBoard - 50+ Sounds</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #222;
      color: #eee;
      text-align: center;
      padding: 20px;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    .sound-control {
      margin: 8px 0;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }
    .sound-name {
      width: 150px;
      text-align: left;
      user-select: none;
    }
    button {
      font-size: 16px;
      min-width: 50px;
    }
    input[type="range"] {
      width: 120px;
    }
    #controls {
      margin-top: 20px;
    }
    #recordStatus {
      margin-top: 10px;
      font-weight: bold;
    }
    footer {
      margin-top: auto;
      padding: 10px 0;
      color: #888;
      font-size: 14px;
      user-select: none;
    }
  </style>
</head>
<body>
  <h1>CalmBoard</h1>

  <div id="soundControls"></div>

  <div id="controls">
    <button id="muteAllBtn">Mute All üîá</button>
    <button id="stopAllBtn">Stop All ‚èπÔ∏è</button>
    <button id="saveStateBtn">Save State üíæ</button>
    <button id="loadStateBtn">Load State üìÇ</button>
    <br><br>
    <button id="startRecBtn">Start Recording üéôÔ∏è</button>
    <button id="stopRecBtn" disabled>Stop Recording ‚èπÔ∏è</button>
    <div id="recordStatus"></div>
  </div>

  <footer>Made With ‚ù§Ô∏è By Aiden</footer>

  <script src="https://cdn.jsdelivr.net/npm/lamejs@1.2.0/lame.min.js"></script>
  <script>
    (async () => {
      // 50+ calming sounds URLs from Pixabay (public domain)
      const soundData = [
        {name: "Rain", url: "https://cdn.pixabay.com/download/audio/2021/08/04/audio_0a6a6e75ab.mp3?filename=rain-ambient-5514.mp3"},
        {name: "Ocean Waves", url: "https://cdn.pixabay.com/download/audio/2021/11/24/audio_0e7dcd82f1.mp3?filename=ocean-waves-10025.mp3"},
        {name: "Forest Night", url: "https://cdn.pixabay.com/download/audio/2022/03/23/audio_446e3e461e.mp3?filename=forest-night-12865.mp3"},
        {name: "Fireplace", url: "https://cdn.pixabay.com/download/audio/2022/02/07/audio_6f9a193ea9.mp3?filename=fireplace-12012.mp3"},
        {name: "Birds Chirping", url: "https://cdn.pixabay.com/download/audio/2021/09/02/audio_3f363d4915.mp3?filename=birds-7749.mp3"},
        {name: "Water Stream", url: "https://cdn.pixabay.com/download/audio/2021/09/07/audio_efb783b7e5.mp3?filename=stream-7950.mp3"},
        {name: "Wind Chimes", url: "https://cdn.pixabay.com/download/audio/2021/11/02/audio_0e44de06a3.mp3?filename=wind-chimes-9343.mp3"},
        {name: "Night Crickets", url: "https://cdn.pixabay.com/download/audio/2021/08/18/audio_5d4a0d56b0.mp3?filename=crickets-6697.mp3"},
        {name: "Thunderstorm", url: "https://cdn.pixabay.com/download/audio/2021/07/15/audio_c3f32c5b31.mp3?filename=thunderstorm-6291.mp3"},
        {name: "Gentle Breeze", url: "https://cdn.pixabay.com/download/audio/2021/10/16/audio_80d0f582c0.mp3?filename=gentle-wind-8624.mp3"},
        {name: "Meditation Bells", url: "https://cdn.pixabay.com/download/audio/2022/05/14/audio_3a33a5b715.mp3?filename=meditation-bells-13862.mp3"},
        {name: "Calm Ocean", url: "https://cdn.pixabay.com/download/audio/2022/03/10/audio_18c35bf5d8.mp3?filename=calm-ocean-12752.mp3"},
        {name: "Soft Piano", url: "https://cdn.pixabay.com/download/audio/2021/08/05/audio_19a9c2f5f5.mp3?filename=soft-piano-5533.mp3"},
        {name: "Rain on Tent", url: "https://cdn.pixabay.com/download/audio/2021/07/11/audio_118f1c5ec5.mp3?filename=rain-on-tent-6213.mp3"},
        {name: "Water Drops", url: "https://cdn.pixabay.com/download/audio/2022/01/25/audio_0a3e4cc006.mp3?filename=water-drops-11161.mp3"},
        {name: "River Flow", url: "https://cdn.pixabay.com/download/audio/2021/09/17/audio_00bc8d457d.mp3?filename=river-flow-8132.mp3"},
        {name: "Wind in Trees", url: "https://cdn.pixabay.com/download/audio/2022/01/31/audio_2163c81c8f.mp3?filename=wind-in-trees-11232.mp3"},
        {name: "Cave Drips", url: "https://cdn.pixabay.com/download/audio/2021/10/11/audio_9b01f7cc7e.mp3?filename=cave-drips-8495.mp3"},
        {name: "Waterfall", url: "https://cdn.pixabay.com/download/audio/2021/07/28/audio_6f29f9c4e4.mp3?filename=waterfall-6456.mp3"},
        {name: "Underwater", url: "https://cdn.pixabay.com/download/audio/2021/09/19/audio_f3d4dfb9bb.mp3?filename=underwater-8195.mp3"},
        {name: "Tibetan Bowls", url: "https://cdn.pixabay.com/download/audio/2021/12/24/audio_28eeb39053.mp3?filename=tibetan-bowls-11113.mp3"},
        {name: "Forest Stream", url: "https://cdn.pixabay.com/download/audio/2022/01/25/audio_c93ec97a87.mp3?filename=forest-stream-11154.mp3"},
        {name: "Gentle Rain", url: "https://cdn.pixabay.com/download/audio/2021/10/12/audio_b6e8ee51a0.mp3?filename=gentle-rain-8503.mp3"},
        {name: "Night Ambience", url: "https://cdn.pixabay.com/download/audio/2021/07/21/audio_3f0b62ac1d.mp3?filename=night-ambience-6347.mp3"},
        {name: "Birdsong", url: "https://cdn.pixabay.com/download/audio/2021/09/06/audio_52931f80f4.mp3?filename=birdsong-7880.mp3"},
        {name: "Relaxing Water", url: "https://cdn.pixabay.com/download/audio/2022/01/29/audio_248de01f9e.mp3?filename=relaxing-water-11203.mp3"},
        {name: "Peaceful Forest", url: "https://cdn.pixabay.com/download/audio/2021/07/16/audio_bf83aabc2b.mp3?filename=peaceful-forest-6310.mp3"},
        {name: "Deep Ocean", url: "https://cdn.pixabay.com/download/audio/2022/02/19/audio_7ca1425d70.mp3?filename=deep-ocean-12112.mp3"},
        {name: "Campfire", url: "https://cdn.pixabay.com/download/audio/2021/09/07/audio_09b7ac5e7c.mp3?filename=campfire-7935.mp3"},
        {name: "Snowfall", url: "https://cdn.pixabay.com/download/audio/2021/11/12/audio_62e63aa479.mp3?filename=snowfall-9752.mp3"},
        {name: "Spring Morning", url: "https://cdn.pixabay.com/download/audio/2021/07/29/audio_44c974cc5b.mp3?filename=spring-morning-6472.mp3"},
        {name: "Calm Wind", url: "https://cdn.pixabay.com/download/audio/2021/08/12/audio_2588698b36.mp3?filename=calm-wind-6674.mp3"},
        {name: "Ocean Breeze", url: "https://cdn.pixabay.com/download/audio/2021/07/19/audio_d40b435c30.mp3?filename=ocean-breeze-6285.mp3"},
        {name: "Distant Thunder", url: "https://cdn.pixabay.com/download/audio/2021/09/08/audio_bf142b9483.mp3?filename=distant-thunder-7965.mp3"},
        {name: "Rainforest", url: "https://cdn.pixabay.com/download/audio/2022/03/04/audio_5689b97a06.mp3?filename=rainforest-12532.mp3"},
        {name: "Gentle Stream", url: "https://cdn.pixabay.com/download/audio/2021/07/27/audio_2d5bc0c1a1.mp3?filename=gentle-stream-6428.mp3"},
        {name: "Light Breeze", url: "https://cdn.pixabay.com/download/audio/2021/08/04/audio_8ce80d24e2.mp3?filename=light-breeze-5516.mp3"},
        {name: "Calm Night", url: "https://cdn.pixabay.com/download/audio/2021/09/12/audio_b5efdc15aa.mp3?filename=calm-night-8032.mp3"},
        {name: "Zen Garden", url: "https://cdn.pixabay.com/download/audio/2022/01/28/audio_9b3cd8e4f9.mp3?filename=zen-garden-11193.mp3"},
        {name: "Crackling Fire", url: "https://cdn.pixabay.com/download/audio/2022/02/08/audio_7d9b08d519.mp3?filename=crackling-fire-12025.mp3"},
        {name: "Birds & Breeze", url: "https://cdn.pixabay.com/download/audio/2021/07/18/audio_62ab02b4bc.mp3?filename=birds-breeze-6274.mp3"},
        {name: "Evening Stream", url: "https://cdn.pixabay.com/download/audio/2021/07/26/audio_0b52b7d02b.mp3?filename=evening-stream-6412.mp3"},
        {name: "Water Drops on Leaves", url: "https://cdn.pixabay.com/download/audio/2021/11/10/audio_4775edb5a3.mp3?filename=water-drops-on-leaves-9714.mp3"},
        {name: "Thunder & Rain", url: "https://cdn.pixabay.com/download/audio/2021/10/19/audio_aa88163aa4.mp3?filename=thunder-rain-8676.mp3"},
        {name: "Morning Birds", url: "https://cdn.pixabay.com/download/audio/2021/07/15/audio_d7c80e355b.mp3?filename=morning-birds-6265.mp3"},
        {name: "Calm Stream", url: "https://cdn.pixabay.com/download/audio/2022/02/07/audio_4e4500cc30.mp3?filename=calm-stream-12004.mp3"},
        {name: "Gentle Waves", url: "https://cdn.pixabay.com/download/audio/2022/01/30/audio_81d1e0c755.mp3?filename=gentle-waves-11244.mp3"},
        {name: "Peaceful Rain", url: "https://cdn.pixabay.com/download/audio/2021/08/30/audio_0a5ff0cdbb.mp3?filename=peaceful-rain-7712.mp3"},
        {name: "Soft Wind", url: "https://cdn.pixabay.com/download/audio/2021/07/31/audio_2114a3ee53.mp3?filename=soft-wind-6457.mp3"},
        {name: "Forest Birds", url: "https://cdn.pixabay.com/download/audio/2021/07/25/audio_71348d01d9.mp3?filename=forest-birds-6397.mp3"},
        {name: "Rain on Window", url: "https://cdn.pixabay.com/download/audio/2021/07/13/audio_9d3d2ae408.mp3?filename=rain-on-window-6238.mp3"},
      ];

      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const masterGain = audioContext.createGain();
      masterGain.connect(audioContext.destination);

      const soundControlsDiv = document.getElementById('soundControls');
      const muteAllBtn = document.getElementById('muteAllBtn');
      const stopAllBtn = document.getElementById('stopAllBtn');
      const saveStateBtn = document.getElementById('saveStateBtn');
      const loadStateBtn = document.getElementById('loadStateBtn');
      const startRecBtn = document.getElementById('startRecBtn');
      const stopRecBtn = document.getElementById('stopRecBtn');
      const recordStatus = document.getElementById('recordStatus');

      let allSources = [];
      let allButtons = [];
      let allVolumes = [];

      async function ensureAudioContextRunning() {
        if (audioContext.state === 'suspended') {
          await audioContext.resume();
        }
      }

      function createSoundControls({name, url}, index) {
        const container = document.createElement('div');
        container.className = 'sound-control';

        const label = document.createElement('div');
        label.className = 'sound-name';
        label.textContent = name;

        const btn = document.createElement('button');
        btn.textContent = '‚ñ∂Ô∏è';

        const vol = document.createElement('input');
        vol.type = 'range';
        vol.min = 0;
        vol.max = 1;
        vol.step = 0.01;
        vol.value = 0.5;

        container.appendChild(label);
        container.appendChild(btn);
        container.appendChild(vol);
        soundControlsDiv.appendChild(container);

        const audio = new Audio(url);
        audio.loop = true;
        const track = audioContext.createMediaElementSource(audio);
        const gainNode = audioContext.createGain();
        gainNode.gain.value = parseFloat(vol.value);
        track.connect(gainNode).connect(masterGain);

        allSources.push({audio, gainNode});
        allButtons.push(btn);
        allVolumes.push(vol);

        btn.addEventListener('click', async () => {
          await ensureAudioContextRunning();

          if (audio.paused) {
            try {
              await audio.play();
              btn.textContent = '‚è∏Ô∏è';
            } catch (e) {
              alert('Playback failed: ' + e.message);
            }
          } else {
            audio.pause();
            btn.textContent = '‚ñ∂Ô∏è';
          }
        });

        vol.addEventListener('input', () => {
          gainNode.gain.value = parseFloat(vol.value);
        });
      }

      soundData.forEach(createSoundControls);

      let isMuted = false;
      muteAllBtn.addEventListener('click', async () => {
        await ensureAudioContextRunning();

        isMuted = !isMuted;
        masterGain.gain.value = isMuted ? 0 : 1;
        muteAllBtn.textContent = isMuted ? 'Unmute All üîä' : 'Mute All üîá';
      });

      stopAllBtn.addEventListener('click', async () => {
        await ensureAudioContextRunning();

        allSources.forEach(({audio}, i) => {
          audio.pause();
          audio.currentTime = 0;
          allButtons[i].textContent = '‚ñ∂Ô∏è';
        });
      });

      saveStateBtn.addEventListener('click', () => {
        const state = allSources.map(({audio, gainNode}) => ({
          playing: !audio.paused,
          currentTime: audio.currentTime,
          volume: gainNode.gain.value
        }));
        localStorage.setItem('calmingSoundboardState', JSON.stringify(state));
        alert('State saved!');
      });

      loadStateBtn.addEventListener('click', async () => {
        await ensureAudioContextRunning();

        const raw = localStorage.getItem('calmingSoundboardState');
        if (!raw) {
          alert('No saved state found.');
          return;
        }
        const state = JSON.parse(raw);
        for (let i = 0; i < state.length; i++) {
          const {playing, currentTime, volume} = state[i];
          const {audio, gainNode} = allSources[i];
          audio.currentTime = currentTime;
          gainNode.gain.value = volume;
          allVolumes[i].value = volume;
          if (playing) {
            try {
              await audio.play();
              allButtons[i].textContent = '‚è∏Ô∏è';
            } catch {
              allButtons[i].textContent = '‚ñ∂Ô∏è';
            }
          } else {
            audio.pause();
            allButtons[i].textContent = '‚ñ∂Ô∏è';
          }
        }
      });

      const dest = audioContext.createMediaStreamDestination();
      masterGain.connect(dest);

      let mediaRecorder;
      let recordedChunks = [];

      startRecBtn.addEventListener('click', async () => {
        await ensureAudioContextRunning();

        recordedChunks = [];
        mediaRecorder = new MediaRecorder(dest.stream, {mimeType: 'audio/webm'});

        mediaRecorder.ondataavailable = e => {
          if (e.data.size > 0) recordedChunks.push(e.data);
        };

        mediaRecorder.onstart = () => {
          recordStatus.textContent = 'Recording... üéôÔ∏è';
          startRecBtn.disabled = true;
          stopRecBtn.disabled = false;
        };

        mediaRecorder.onstop = async () => {
          recordStatus.textContent = 'Encoding MP3... ‚è≥';

          const webmBlob = new Blob(recordedChunks, {type: 'audio/webm'});
          const arrayBuffer = await webmBlob.arrayBuffer();
          const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);

          const mp3Blob = encodeMp3(audioBuffer);

          const url = URL.createObjectURL(mp3Blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'calmboard-recording.mp3';
          a.click();
          URL.revokeObjectURL(url);

          recordStatus.textContent = 'Recording saved as MP3 ‚úÖ';
          startRecBtn.disabled = false;
          stopRecBtn.disabled = true;
        };

        mediaRecorder.start();
      });

      stopRecBtn.addEventListener('click', () => {
        if (mediaRecorder && mediaRecorder.state === 'recording') {
          mediaRecorder.stop();
        }
      });

      function encodeMp3(audioBuffer) {
        const numChannels = audioBuffer.numberOfChannels;
        const sampleRate = audioBuffer.sampleRate;
        const mp3encoder = new lamejs.Mp3Encoder(numChannels, sampleRate, 128);

        const samples = [];
        for(let ch = 0; ch < numChannels; ch++) {
          samples.push(audioBuffer.getChannelData(ch));
        }

        const blockSize = 1152;
        const mp3Data = [];

        for (let i = 0; i < samples[0].length; i += blockSize) {
          const sampleChunk = [];
          for (let ch = 0; ch < numChannels; ch++) {
            sampleChunk[ch] = samples[ch].subarray(i, i + blockSize);
          }
          let mp3buf;
          if (numChannels === 1) {
            mp3buf = mp3encoder.encodeBuffer(floatTo16BitPCM(sampleChunk[0]));
          } else {
            mp3buf = mp3encoder.encodeBuffer(
              floatTo16BitPCM(sampleChunk[0]),
              floatTo16BitPCM(sampleChunk[1])
            );
          }
          if (mp3buf.length > 0) mp3Data.push(mp3buf);
        }
        const mp3buf = mp3encoder.flush();
        if (mp3buf.length > 0) mp3Data.push(mp3buf);

        return new Blob(mp3Data, {type: 'audio/mp3'});
      }

      function floatTo16BitPCM(input) {
        const output = new Int16Array(input.length);
        for (let i = 0; i < input.length; i++) {
          let s = Math.max(-1, Math.min(1, input[i]));
          output[i] = s < 0 ? s * 0x8000 : s * 0x7FFF;
        }
        return output;
      }
    })();
  </script>
</body>
</html>
